# 微信聊天记录导入指南

## 🎉 现在更简单了！

经过优化，系统现在**直接支持chatlog原始格式**，无需手动转换！

## 📋 使用步骤

### 1. 导出微信聊天记录
使用chatlog工具导出JSON格式：
```bash
./chatlog export --platform wechat --group-name "群名称" --output ./wechat_data.json
```

### 2. 直接上传原始文件
- 打开知识库网站上传页面
- 直接拖拽或选择chatlog导出的JSON文件
- **支持中文文件名**（系统会自动处理编码问题）
- 文件大小限制：50MB

### 3. 系统自动处理
系统会自动：
- ✅ 识别chatlog复杂格式
- ✅ 提取有效消息内容
- ✅ 过滤系统消息和无效内容
- ✅ 自动问答对提取和分类
- ✅ 处理中文文件名编码问题

## 🔧 技术改进

### 后端优化
- **智能格式识别**：自动识别chatlog的复杂JSON结构
- **内容提取增强**：支持嵌套contents、recordInfo等字段
- **时间戳处理**：支持ISO格式时间（如2025-07-28T09:21:50+08:00）
- **消息过滤**：自动跳过系统消息（type: 3, 10000）和无效内容

### 前端优化  
- **文件名处理**：自动清理中文字符，避免"Invalid key"错误
- **编码兼容**：支持包含中文的文件名上传

## 📊 处理效果对比

| 项目 | 优化前 | 优化后 |
|------|--------|--------|
| 支持格式 | 仅简单格式 | chatlog原始格式 + 简单格式 |
| 文件名支持 | 仅英文 | 中文自动转换 |
| 手动转换 | 需要 | 不需要 |
| 处理效率 | 手动3步 | 自动1步 |

## ⚡ 一键上传流程

1. **打开浏览器** → 访问知识库网站
2. **拖拽文件** → 直接拖拽chatlog导出的JSON文件
3. **等待处理** → 系统自动解析并入库
4. **开始搜索** → 立即可以搜索问答内容

## 🚨 注意事项

- 确保JSON文件是chatlog工具导出的标准格式
- 文件大小不超过50MB
- 建议先测试小文件，确认效果后再上传大文件
- 系统会过滤掉过短（<10字符）和纯表情的消息

## 📝 文件格式支持

### ✅ 支持的chatlog格式
```json
[
  {
    "senderName": "用户名",
    "time": "2025-07-28T09:21:50+08:00",
    "content": "简单消息内容",
    "type": 1
  },
  {
    "senderName": "用户名",
    "time": "2025-07-28T09:21:50+08:00",
    "contents": {
      "desc": "复杂消息描述",
      "recordInfo": {
        "DataList": {
          "DataItems": [...]
        }
      }
    },
    "type": 1
  }
]
```

### ✅ 同时支持简单格式
```json
[
  {
    "id": "msg_001",
    "timestamp": 1704067200000,
    "from_user": "用户名",
    "content": "消息内容",
    "message_type": "text"
  }
]
```

## 🎯 现在你只需要：

1. 使用chatlog导出微信聊天记录
2. 直接上传JSON文件到知识库
3. 开始搜索和使用！

**不再需要手动转换格式！** 🎉